<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Boggle Game</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <h1>Boggle Game</h1>
    <div id="board-container">
      <table>
        {% for row in board %}
        <tr>
          {% for letter in row %}
          <td>{{ letter }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </table>
    </div>

    <form id="guess-form">
      <input type="text" id="guess" placeholder="Enter your guess" required />
      <button type="submit">Submit Guess</button>
    </form>

    <div id="message"></div>
    <div>Score: <span id="score">0</span></div>
    <div id="timer">Time remaining: 60 seconds</div>
    <div>Plays: <span id="plays">{{ plays }}</span></div>
    <div>High Score: <span id="high_score">{{ high_score }}</span></div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      let guessedWords = new Set();
      let score = 0;
      let timeRemaining = 60;
      let timer;

      $(document).ready(function () {
        timer = setInterval(function () {
          if (timeRemaining > 0) {
            timeRemaining--;
            $("#timer").text(`Time remaining: ${timeRemaining} seconds`);
          } else {
            clearInterval(timer);
            $("#guess-form :input").prop("disabled", true);
            $("#message").text("Time is up! Game over.");
            axios
              .post("/end_game", { score: score })
              .then(function (response) {
                const plays = response.data.plays;
                const high_score = response.data.high_score;
                $("#plays").text(plays);
                $("#high_score").text(high_score);
              })
              .catch(function (error) {
                console.log(error);
              });
          }
        }, 1000);

        $("#guess-form").on("submit", function (event) {
          event.preventDefault();
          let guess = $("#guess").val().trim();

          if (guessedWords.has(guess)) {
            $("#message").text("You have already guessed that word.");
            $("#guess").val(""); // Clear the input field
            return;
          }

          axios
            .post("/check_word", { word: guess })
            .then((response) => {
              let result = response.data.result;
              let message = "";

              if (result === "ok") {
                message = "Correct!";
                score += guess.length;
                $("#score").text(score);
                guessedWords.add(guess); // Add the guessed word to the set
              } else if (result === "not-on-board") {
                message = "Word not on board.";
              } else {
                message = "Not a valid word.";
              }

              $("#message").text(message);
              $("#guess").val(""); // Clear the input field
            })
            .catch((error) => {
              console.error("Error:", error);
              $("#message").text("An error occurred.");
              $("#guess").val(""); // Clear the input field
            });
        });
      });
    </script>
  </body>
</html>
